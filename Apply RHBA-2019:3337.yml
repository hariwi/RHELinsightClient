---
# Red Hat Insights has recommended one or more actions for you, a system administrator, to review and if you
# deem appropriate, deploy on your systems running Red Hat software. Based on the analysis, we have automatically
# generated an Ansible Playbook for you. Please review and test the recommended actions and the Playbook as
# they may contain configuration changes, updates, reboots and/or other changes to your systems. Red Hat is not
# responsible for any adverse outcomes related to these recommendations or Playbooks.
#
# RHBA-2019:3337
# https://cloud.redhat.com/insights/remediations/7c9fbc58-a8f5-4e8e-a6c8-d42e56294520
# Generated by Red Hat Insights on Fri, 25 Jun 2021 02:32:58 GMT
# Created by hari.wibowo

# Apply RHBA-2019:3337
# Identifier: (patch-advisory:RHBA-2019:3337,fix)
# Version: 30f36af0250cb6293c57fb19c9337d88cc82d591
- name: update packages
  hosts: 192.168.122.41
  vars:
    insights_issues: "RHBA-2019:3337"
    insights_signature_exclude: "/hosts,/vars/insights_signature,/vars/insights_issues"
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVaHBRWGh6ZG5jMU9FUXJhalZ3VGtGUlp5OUxRa0ZCYTNacE9V
      Tm9VaTlTWmtaV0syVjFZVmxsUVhCc1pVOXFTMDVwTldVeFJqTUtSRkpNTkhjMUwyRkdOR1pRVDJw
      UmRtbzBPVnB0Wmt4d1FrRlpjVWh4WTNjMFZIcHJha2RqY0dGUWNVMDBiVE5vWTIxSFJTdEJhbmhN
      TUhwcWRXVktTZ293YTJoVVNHTnFXbFprUW1WSVMzVjBOVXRRZFRoUVJIRm1jREU0UlVoUFQzcHNZ
      MjF3ZVdsblR6WkxZbU5UVjFaTmVVTjZkR0l3UzBGTFFqWktibmw2Q25GWWFUbDJkWEZ6WWt0dE5s
      cHZSa3hSTlVWQ1pqRmhZVlo2V1ZsdVFrMXNlVFp4ZFZOelpEZEVia2xLYm0weGVreE1iV1EwUzFw
      QmJWcGFkMVFyZFdVS1JrNHhRMDUwZGpaRk9GWTNTM2sxZDFVeFdYRnVRWGh4YW5FNGRrSlZiVE5R
      YURKcVVEZERhRE5MWTFkYU1IZDNTMk1yWldRME4yeE5XVTUyUkhnMU9BcFllV1JLWWxkaVdTdFha
      bGRzTTJWcU9ERTRlVzgzVUdKNU4xQlZTMGg2Tm1obGJrRllhakZZZHpKbWJFVXdja1V6SzBGSFlW
      TmFWMmRVYzNaYWFuTnJDa2hUVkdWamF6TXlhMkUzZWsxa2FEZHhSRkJ0VTNGQlkwOXRRWFZSZWxC
      VEt6UmlkbWtyUWxaRVZEaFlaSGhRVHpBMlpTdDNVV3BRY0VSWFRFaE1NMVFLUTFGeFJUVkNiVkpx
      VGxGRFVHODJNMlJVTUVwcU1USnFXa2xpY1VabVVIZHBiMWxhVTA5cVNuQmlNVmt4VWpSWFFXOXdT
      VGhzZDBjMVJrZEZaRTV2TVFvd2VFaHBkVkoyTjFjck0weFBRa3hCUldwM2QwdG9PRkE0VDI5UWVq
      SnlSMFpKY2pCSlUyeFROR0oyYkM5SmRuaDZTR2xFT1ZWMldUTjFZVk5uWVZoWkNsZzNSbkpxUW1a
      TFEzSlhRbFZTUm1oVEwyOXZhMlJRUVdWb1NsVlpZWHBsYlZRck1XNHJVM2h3YTFCMmFWQnRiRVJy
      ZDB0c2NIYzBlbTFtTms0NFZDc0tNbEVyZEdSR1pqRXlPWFJJVTJoMU1IaFhkVmhsTmpCc0wyZEdZ
      aTlpZUZaQlNrVnVabmxQY2xaa1kxUXpTMVJVVUhRdk5qSnhSWEl3T0VWamJXTkpWQXBGWnpWME5u
      YzRTbVp4TkQwS1BWaEJhME1LTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  become: true
  tasks:
    - name: check for update
      shell: "{{ ansible_facts['pkg_mgr'] }} check-update -q --advisory {{ insights_issues | regex_search('RH[SBE]A-20[\\d]{2}:[\\d]{4,5}( --advisory RH[SBE]A-20[\\d]{2}:[\\d]{4,5})*') }}"
      check_mode: no
      register: check_out
      failed_when: check_out.rc != 0 and check_out.rc != 100
      args:
        warn: false

    - when: check_out.rc == 100
      name: upgrade package
      shell: "{{ ansible_facts['pkg_mgr'] }} update -d 2 -y --advisory {{ insights_issues | regex_search('RH[SBE]A-20[\\d]{2}:[\\d]{4,5}( --advisory RH[SBE]A-20[\\d]{2}:[\\d]{4,5})*') }}"
      args:
        warn: false

    - when: check_out.rc == 100
      name: set reboot fact
      set_fact:
        insights_needs_reboot: true

# Automatic system reboot was suppressed for this playbook.
# This play lists the systems that need to be rebooted manually for the changes to take effect.
- name: Reboot reminder
  hosts: 192.168.122.41
  gather_facts: false
  vars:
    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVaHBRekZ6ZG5jMU9FUXJhalZ3VGtGUmFHaDNkeTh2VVV4SFJE
      aFFNM1l3VlhKWmRFUldabGhaUWxWSFNGQkpUbkpNV1ZCNFFUUUtXWFJXUmtFd1ZXb3diWGhyVVVG
      RFNtbHNZbVJGYVVWdVJIaFVZMVpDZDFSMlpVd3dTVWR0Um5sVVZVWkRVVEZ6WkdRMVUwc3JRMlJy
      TjJKa2RHTmliQW81TlRkaWJtZzVXbk5xYm14dWEwOU5ObTlyVFhVNFNraDZSMDFRV1hST01VaHdR
      VGxJYVV4Mk9IaEdPSFYzTmtkMWQycE9PREJ5ZDNaMmVIZG1WWEpOQ2psWFdYZE1PVU51UzJaRk16
      QnVOM04wTDA1TGJFbDFMMmd3Y2pKU1JTc3hPV1Z0TUdodVJsQmhaa2RwT1RZeWRXaFVTRGhZYzB4
      VWVHOXlRekZhU0c4S09VeENlRU5PVWsxc1draGljVGhzYVd0UVJsaFBhekkxTlNzdmFXMUdkazlE
      V1hwT1RuRXpkVkYxTDB0SWFGTTVhemRaT0Vwb0wyRjZTRFYzYW5KNlV3cDNNekJ1Y25JeVNVOW1j
      V0V2VUdWRlJXOU5SbUV3UVV4WWRFZFVSREpyWmk5Q1pIVXlSemRUU0hkMFNsaG9VbEJzVnpKNU9H
      MW1Za2wwY0UxYWMyTlFDbFp2WkhoVmEwbGtkVXhUTmpaM04wODBPRTVRT1V0Uk9XbE9Wa2hCTVdo
      NVZTOTFWekkwT1ZFd2EwWjZlR3BEUVhsR1QwY3pabkZRUkhWaWNVeFlkbkFLTjB0bFJGWklRbFpS
      UVVkckwwUnhSMFpYT0hoMlVUUkZkSEpVTldrMlVsb3hVRlJMZEZCVmNrVmpRV2hoU2xsWlMwRm9X
      U3R4Y2pkUE1WSkhkazFxUlFwTlEzbFFjVlZ1U0hJMFNHSmtjelJTU0drNVJucFFaeXN2VjB0M2F6
      VnRhMUJMTUUxaEsyMUxkVXd5YTI1elUwaDFTakEzVkVVMk1HNU1WbGM0YTFwakNsSllibGxCU1ZB
      d1RGUnRUMHhvWms0NWJtdzVOM2hvUTNSUFdrZFBjMVp3WVhWdlIyZENOV0ZrV1ZGYVZXY3JSVzF0
      UldSQ1ZrdDZOVUp2VERWc1pYTUtVMjVQVkd3dmFEbG9hekpqYm0xVVdWRTFRa1JoY1RSdGR6QnFS
      SGhDTjFWUWNVdDFZazFDUTJoSVdIUnRVRFpGT1hSU1pYRnNiWHB0YWxkR2QxWnpZd3B1TDBGRFpW
      ZzFZVUUxY3owS1BXZHFZbWdLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - debug:
        msg: "Automatic system reboot was suppressed for this playbook. Reboot {{inventory_hostname}} manually for the changes to take effect."
      when:
        - insights_needs_reboot is defined
        - insights_needs_reboot

- name: run insights
  hosts: 192.168.122.41
  become: true
  gather_facts: false
  vars:
    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVaHBRaXR6ZG5jMU9FUXJhalZ3VGtGUmFXdDRaeTh2WmtaRFoz
      QXlTblIxVEd0UU5qQnNTa3BZYm1GU1JGTjVjVVYwU0ZSNlRGY0tOVlZSVlc5MWEyUmpVRFJVUlZn
      d01EaDFhRkJHUzFaSmVrdFVTR2RsYTFOaU1UUXlkMjlQYm5sR2VUUnpRbEJrZEZoaGREVlliWEp0
      VGxsR1EwaEVWZ28xYVhSdlNrcDBPVzg1UWtkQlJVaDVZMFJ3SzBoNVNqWXphM0paZVRGUk1rOXVU
      azF3VjJaSmNtYzJUakJXVTJoa1JtVk1lR0ppTjBaMlpFaEpjbFo2Q2pJNGFrdHhOemx1Tm13eUx6
      aDZZVkJSTDFkWVZIWkNaMDVhUkVWTFJ6TmhSSFl3WVRkbWIyUnlPRWhEZGxseE5tNUhNRkZOY1RO
      U1ZFOXBkbFZtTTFnS1JuQnlhVTh2TDNKSlRDOVlSelE1TTA1NGFWSjBRakVyZEhSUk0wZHNhM1ZE
      ZFVwck1EQkdaREp0ZDNZNFprRnZaR2xUUW5aelQydEpZekZyV25adFN3cEJjR3BEY1ZKMWVHaExU
      MDgzYWxZM1FYSnRTV0p6TkhobVJrUkJVMkZaV2t4R01VMHZhME42ZWs1d1MwTjFhbE5hVUUxRlVt
      WlhhV2RHVGpGMWRqRjNDalpQSzB0b1pTdFJVRU5hUm5CV1kwVndSbTFSTVdwcWFrOVFPV2haSzNW
      alZWSnhSVEkyTlhGTWRuWnFSWE4wUW5WQk4xQkZNRVZ3UkRsaU5VaFZSM1lLTkZKemJXc3pNbFpC
      Vnl0WE5IWk1VRWQwZG1sQ00wSXpUbE0wZUhCdVIzSmlObGs1Y1cwNFZuVTJSRUZIV2xOYWRsbFlk
      bWQwTm1WR2N6RTVTVFZZUWdvMGVtcFVSRUlyTW1sT2NrcE9jM2d5YURoU1VGVnJMMmhZUzFKMGEy
      WnZZMlpKZVRkcGNWY3hiMGRsTlZSMmFqTTFSbXRqUld0YU9VRnpSMjl6WXpWMENuUlZkVlZJWWpS
      ME5EVTFSSE5EWlZWc1ZEZFNOakJDTTB4d1Z6TmlTRTF0YzFCMEx6RktNRFEwYm1KS2RFTkhUM1Jy
      UVVWWVRsVTJlbGxUTDNBMFFqSUtaSFYxY2tZdlNHUnFWWFJNVDNSdlNFTnlZVWd2WkZwaFRVNTZk
      MVZpZUc1VFZXUkdZU3R6TTBaNFJHczFVVkU0VVRaMVVucFpRbWw0WkcxeWREZGpUQXBKYTA1NlEy
      aHBRMDlrY3owS1BVMVZOMk1LTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - name: run insights
      command: insights-client
      changed_when: false
